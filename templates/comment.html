<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>comment table</title>

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.31.0/js/jquery.tablesorter.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.31.0/css/theme.default.min.css">

  <style>
    #comment-table th { background-color: pink; }
    .table td { max-width: 900px; }

    .comment-cell { white-space: pre-wrap; }
    .reply { padding-left: 18px; }
    .reply::before { content: ">> "; color: #007bff; font-weight: bold; }

    .icn img { border-radius: 6px; }

    /* 画像みたいに広いコメント列 */
    .col-comment { width: 60%; }
  </style>

  <script>
    $(document).ready(function() {
      $("#comment-table").tablesorter({
        // コメント本文/アイコンはソート不要
        headers: {
          2: { sorter: false },
          6: { sorter: false }
        }
      });
    });
  </script>
</head>

<body>
  <div class="container-fluid my-3">
    <div class="d-flex align-items-center">
      <a class="btn btn-sm btn-outline-secondary mr-2" href="/">検索へ</a>
      <a class="btn btn-sm btn-outline-primary" href="{{ watch_url }}" target="_blank">動画を開く</a>
      <div class="ml-3">Video ID: {{ video_id }}</div>
    </div>

    {% if error %}
      <div class="alert alert-danger mt-3">{{ error }}</div>
    {% endif %}

    <table id="comment-table" class="table table-bordered mt-3">
      <thead>
        <tr>
          <th>No</th>
          <th>投稿日時</th>
          <th class="col-comment">コメント</th>
          <th>Like数</th>
          <th>リプライ数</th>
          <th>ユーザーID</th>
          <th>icn</th>
        </tr>
      </thead>

      <tbody>
      {% for r in rows %}
        <tr>
          <!-- No：1 / 1-1 みたいに -->
          <td data-sort-value="{{ r.sortNo }}">{{ r.no }}</td>

          <!-- 投稿日時：表示はJST、ソートはISO -->
          <td data-sort-value="{{ r.publishedAtIso }}">{{ r.publishedAt }}</td>

          <!-- コメント：返信は >> 付き -->
          <td>
            <div class="comment-cell {% if r.isReply %}reply{% endif %}">
              {{ r.text }}
            </div>
          </td>

          <td>{{ r.likeCount }}</td>
          <td>{{ r.replyCount }}</td>

          <td>
            {% if r.authorChannelUrl %}
              <a href="{{ r.authorChannelUrl }}" target="_blank">{{ r.userId }}</a>
            {% else %}
              {{ r.userId }}
            {% endif %}
          </td>

          <td class="icn">
            {% if r.iconUrl %}
              <img src="{{ r.iconUrl }}" height="40" width="40">
            {% endif %}
          </td>
        </tr>
      {% endfor %}
      </tbody>
    </table>

    {% if next_page_token %}
      <a class="btn btn-outline-primary"
         href="/comment?video-id={{ video_id }}&pageToken={{ next_page_token }}">
        次のページ（トップコメント）
      </a>
    {% endif %}
  </div>
</body>
</html>
